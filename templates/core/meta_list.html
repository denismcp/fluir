{% extends "base.html" %}
{% load humanize %}

{% block title %}Metas de Performance | Fluir{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-sm-flex align-items-center justify-content-between mb-4 px-2">
        <div>
            <h1 class="h3 mb-1 text-gray-800 font-weight-bold">Metas de Performance</h1>
            <p class="text-muted small">Gerenciamento de objetivos comerciais globais e individuais</p>
        </div>
        <button class="btn btn-success rounded-pill px-4 shadow-sm font-weight-bold"
                style="background: #2dce89; border: none; height: 45px;"
                hx-get="{% url 'tc_core:meta_create' %}" 
                hx-target="#htmx-modal-content"
                data-toggle="modal" data-target="#htmx-modal">
            <i class="fas fa-plus-circle mr-2"></i>Nova Meta
        </button>
    </div>

    <div class="card shadow-sm border-0 rounded-15 overflow-hidden">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-muted small text-uppercase">
                        <tr>
                            <th class="px-4 py-3 border-0">Vendedor / Escopo</th>
                            <th class="py-3 border-0 text-center">Período</th>
                            <th class="py-3 border-0 text-center">Valor Objetivo</th>
                            <th class="px-4 py-3 border-0 text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm">
                        {% for meta in metas %}
                        <tr style="cursor: pointer;" 
                            hx-get="{% url 'tc_core:meta_update' meta.pk %}" 
                            hx-target="#htmx-modal-content"
                            data-toggle="modal" data-target="#htmx-modal">
                            
                            <td class="px-4 py-3">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-soft-{% if meta.vendedor %}success{% else %}primary{% endif %} text-{% if meta.vendedor %}success{% else %}primary{% endif %} d-flex align-items-center justify-content-center mr-3" style="width: 35px; height: 35px; font-weight: bold;">
                                        {% if meta.vendedor %}<i class="fas fa-user-tag"></i>{% else %}<i class="fas fa-globe"></i>{% endif %}
                                    </div>
                                    <span class="font-weight-bold text-dark border-bottom-dashed">
                                        {{ meta.vendedor.get_full_name|default:"GLOBAL EMPRESA" }}
                                    </span>
                                </div>
                            </td>
                            <td class="text-center">
                                <span class="badge badge-pill badge-light text-dark px-3 py-2 font-weight-bold">
                                    {{ meta.get_mes_display }} / {{ meta.ano }}
                                </span>
                            </td>
                            <td class="text-center font-weight-bold text-dark">R$ {{ meta.valor_objetivo|intcomma }}</td>
                            <td class="px-4 text-center">
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-white text-primary border-0 rounded-circle mr-2"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-white text-danger border-0 rounded-circle"
                                            hx-get="{% url 'tc_core:meta_delete' meta.pk %}"
                                            hx-target="#htmx-modal-content"
                                            onclick="event.stopPropagation();"
                                            data-toggle="modal" data-target="#htmx-modal">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="4" class="text-center py-5 text-muted">Nenhuma meta cadastrada.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    .rounded-15 { border-radius: 15px !important; }
    .bg-soft-success { background-color: #e6fffa; color: #38b2ac; }
    .bg-soft-primary { background-color: #ebf4ff; color: #4299e1; }
    .border-bottom-dashed { border-bottom: 1px dashed #dee2e6; }
    .table-hover tbody tr:hover { background-color: #f8f9fe; }
</style>
{% endblock %}