{% load humanize %}

<div class="h-100 d-flex flex-column animate__animated animate__fadeInRight bg-white">
    <div class="p-4 pb-2 border-bottom bg-light">
        <div class="d-flex align-items-center mb-3">
            <div style="width: 32px;"></div> 

            <div class="flex-grow-1 text-center">
                <span class="badge-status status-{{ fatura.status }} shadow-sm">
                    {{ fatura.get_status_display }}
                </span>
            </div>
            
            <div class="dropdown no-arrow">
                <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in">
                    <div class="dropdown-header">Opções do Título:</div>
                    
                    {% if fatura.status != 'pago' %}
                        <a class="dropdown-item" href="#" hx-get="{% url 'financeiro:fatura_update' fatura.pk %}" hx-target="#htmx-modal-content" data-toggle="modal" data-target="#htmx-modal">
                            <i class="fas fa-edit fa-sm fa-fw mr-2 text-gray-400"></i>Editar Dados
                        </a>
                    {% else %}
                        <a class="dropdown-item text-muted" href="javascript:void(0);" style="cursor: not-allowed; opacity: 0.6;">
                            <i class="fas fa-lock fa-sm fa-fw mr-2 text-gray-400"></i>Edição Bloqueada
                        </a>
                    {% endif %}

                    <a class="dropdown-item" href="#"><i class="fas fa-copy fa-sm fa-fw mr-2 text-gray-400"></i>Duplicar Título</a>
                    
                    <div class="dropdown-divider"></div>

                    {% if fatura.status != 'pago' %}
                        <a class="dropdown-item text-danger" href="#" 
                        hx-get="{% url 'financeiro:fatura_delete' fatura.pk %}" 
                        hx-target="#htmx-modal-content" 
                        data-toggle="modal" 
                        data-target="#htmx-modal">
                            <i class="fas fa-trash fa-sm fa-fw mr-2"></i>Excluir Registro
                        </a>
                    {% else %}
                        <a class="dropdown-item text-muted" href="javascript:void(0);" 
                        style="cursor: not-allowed; opacity: 0.6;" 
                        title="Títulos pagos não podem ser excluídos">
                            <i class="fas fa-ban fa-sm fa-fw mr-2 text-gray-400"></i>Excluir (Bloqueado)
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <h4 class="text-center font-weight-900 text-dark mb-1">{{ fatura.numero_documento|default:"SEM NÚMERO" }}</h4>
        <p class="text-center text-muted small mb-0 font-weight-bold">ID Interno: #{{ fatura.pk }}</p>
    </div>

    <div class="flex-grow-1 overflow-auto p-4 pt-3">
        
        <div class="mb-3">
            <label class="text-xs font-weight-bold text-primary text-uppercase mb-1 d-block">Cliente / Parceiro</label>
            <h6 class="font-weight-bold text-dark mb-0">{{ fatura.cliente.razao_social }}</h6>
            <small class="text-muted">{{ fatura.cliente.nome_fantasia|default:"---" }}</small>
        </div>

        <div class="p-3 bg-gray-100 rounded-24 mb-4 border-left-primary shadow-sm">
            <div class="row text-center">
                <div class="col-6 border-right">
                    <label class="text-xs text-uppercase font-weight-bold text-muted mb-0">Valor Total</label>
                    <div class="font-weight-900 text-dark">R$ {{ fatura.valor_total|floatformat:2|intcomma }}</div>
                </div>
                <div class="col-6">
                    <label class="text-xs text-uppercase font-weight-bold text-muted mb-0">Saldo</label>
                    <div class="font-weight-900 text-danger">R$ {{ fatura.valor_saldo|floatformat:2|intcomma }}</div>
                </div>
            </div>
        </div>

        <label class="text-xs font-weight-bold text-gray-500 text-uppercase mb-3 d-block">Gestão e Documentos</label>
        <div class="row no-gutters mb-4">
            <div class="col-4 p-1">
                <button class="btn btn-light w-100 py-3 rounded-12 border text-dark shadow-xs" title="Emitir NFe">
                    <i class="fas fa-file-invoice d-block mb-1 text-primary"></i>
                    <span style="font-size: 0.65rem;" class="font-weight-bold uppercase">NFe</span>
                </button>
            </div>
            <div class="col-4 p-1">
                <button class="btn btn-light w-100 py-3 rounded-12 border text-dark shadow-xs" title="Anexos">
                    <i class="fas fa-paperclip d-block mb-1 text-info"></i>
                    <span style="font-size: 0.65rem;" class="font-weight-bold uppercase">Anexos</span>
                </button>
            </div>
            <div class="col-4 p-1">
                <button class="btn btn-light w-100 py-3 rounded-12 border text-dark shadow-xs" title="Enviar E-mail">
                    <i class="fas fa-envelope d-block mb-1 text-warning"></i>
                    <span style="font-size: 0.65rem;" class="font-weight-bold uppercase">E-mail</span>
                </button>
            </div>
            <div class="col-4 p-1">
                <button class="btn btn-light w-100 py-3 rounded-12 border text-dark shadow-xs" title="Tarefas vinculadas">
                    <i class="fas fa-tasks d-block mb-1 text-success"></i>
                    <span style="font-size: 0.65rem;" class="font-weight-bold uppercase">Tarefas</span>
                </button>
            </div>
            <div class="col-4 p-1">
                <button class="btn btn-light w-100 py-3 rounded-12 border text-dark shadow-xs text-danger" title="Cancelar Título">
                    <i class="fas fa-ban d-block mb-1"></i>
                    <span style="font-size: 0.65rem;" class="font-weight-bold uppercase">Cancelar</span>
                </button>
            </div>
            <div class="col-4 p-1">
                <a href="{% url 'financeiro:fatura_recibo' fatura.pk %}" target="_blank" class="btn btn-light w-100 py-3 rounded-12 border text-dark shadow-xs" title="Imprimir Recibo">
                    <i class="fas fa-print d-block mb-1 text-secondary"></i>
                    <span style="font-size: 0.65rem;" class="font-weight-bold uppercase">Recibo</span>
                </a>
            </div>
        </div>

        {% if fatura.descricao %}
        <div class="mb-2">
            <label class="text-xs font-weight-bold text-primary text-uppercase d-block">Descrição</label>
            <p class="text-dark small border-left-secondary pl-2 mt-1">{{ fatura.descricao }}</p>
        </div>
        {% endif %}
    </div>

    <div class="p-4 border-top bg-white">
        {% if fatura.status != 'pago' %}
        <button class="btn btn-success btn-block btn-lg rounded-pill shadow-sm font-weight-900"
                hx-get="{% url 'financeiro:fatura_confirm_liquidar' fatura.pk %}"
                hx-target="#htmx-modal-content"
                data-toggle="modal" 
                data-target="#htmx-modal"
                style="height: 55px; background: linear-gradient(90deg, #1cc88a 0%, #13855c 100%); border: none;">
            <i class="fas fa-check-double mr-2"></i>LIQUIDAR AGORA
        </button>
        {% else %}
        <div class="alert alert-success border-0 text-center rounded-pill mb-0 font-weight-bold py-3 shadow-xs">
            <i class="fas fa-check-circle mr-2"></i>TÍTULO TOTALMENTE PAGO
        </div>
        {% endif %}
        
        <button class="btn btn-outline-primary btn-block rounded-pill mt-3 font-weight-bold btn-sm">
            <i class="fas fa-share-alt mr-2"></i>COMPARTILHAR COBRANÇA
        </button>
    </div>
</div>